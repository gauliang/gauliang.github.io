<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>深入 React Redux - Gauliang</title><meta name="next-head-count" content="3"/><link href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" rel="stylesheet"/><link rel="icon" href="/favicon.svg"/><link rel="apple-touch-icon" href="/favicon.png"/><link rel="apple-touch-startup-image" href="/favicon.png"/><link rel="manifest" href="/manifest.json"/><meta content="viewport-fit=cover, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/><meta name="apple-mobile-web-app-title" content="Blog"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="theme-color" content="#FFF"/><link rel="preload" href="/_next/static/css/3296e546f1dca7eb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3296e546f1dca7eb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d7b038a63b619762.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-03586e2758997a42.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1260c18e5affe90c.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-cbec42c88474d6d7.js" defer=""></script><script src="/_next/static/chunks/815-f2a9309f5cf9923e.js" defer=""></script><script src="/_next/static/chunks/424-0bdf08c6110b9796.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5B...id%5D-bfe83f0756774a04.js" defer=""></script><script src="/_next/static/S5tPGcmy4nejKnHha2s_A/_buildManifest.js" defer=""></script><script src="/_next/static/S5tPGcmy4nejKnHha2s_A/_ssgManifest.js" defer=""></script><script src="/_next/static/S5tPGcmy4nejKnHha2s_A/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><nav class="md:sticky md:top-0 backdrop-blur md:from-transparent md:to-transparent md:bg-white/80 border-gray-200 border-b py-2 md:py-5  md:px-0 dark:bg-gray-800 dark:border-gray-700 z-10"><div class="md:container md:mx-auto flex flex-wrap flex-col md:flex-row justify-between"><div class="hidden md:flex px-5 md:px-0 flex-row justify-between text-[#0069ff] dark:text-white"><div class="flex flex-row cursor-pointer"><svg class="w-8 h-8 my-1" viewBox="0 0 512 512" fill="currentColor"><path d="M238.74,366.17c-24.56,0.42-12.59,0.42-36.76,0 C92.86,358.74,92.54,257.24,92.54,257.24s-3.78-104.91,109.44-110.42c105.79,0.4,195.22,0.23,242.54,0.08 c40.86-0.53,36.61-7.61,26.7-24.61C447.75,81.99,384.8,3.28,250.71,0C-60.02,17.45-88.35,433.93,194.97,504.76 c42.5,12.75,91.65,4.77,91.65,4.77s-0.23-52.54,0-94.13C286.82,378.65,274.71,365.55,238.74,366.17z M482.55,207.28 c-12,0.02-229.21,1.03-280.57,0.86c-48.75-0.16-48.73,49.23-48.73,49.23s0.19,47.49,48.73,47.5c-0.03,0,109.56-0.35,121.41,0 c11.91,0.35,24.03,12.59,23.94,25.04c-0.19,27.35,0.46,163.59,0.64,163.53c24.08-8.5,157.24-66.58,161.49-236.57 C510.08,231.99,506.75,207.3,482.55,207.28z"></path></svg><span class="text-xl h-8 ml-2 my-1.5 font-semibold">Gauliang</span></div><div class="md:hidden"><div class="relative"><button class=" flex h-10 flex-row items-center py-2 focus:outline-none text-inherit" id="headlessui-popover-button-:R4b6:" type="button" aria-expanded="false"><span class="dark:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg> <!-- --></span><span class="hidden dark:inline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></svg></span></button></div></div></div><div class="hidden mt-2 border-b -mb-3 divide-gray-400 dark:border-gray-700"></div><div class="hidden md:flex  items-center flex-col md:flex-row mt-5 md:mt-0"><ul class="flex flex-row justify-between space-x-2 md:space-x-6 "><li><a class="block py-2 pr-4 pl-3  font-semibold " href="/">首页</a></li><li><a class="block py-2 pr-4 pl-3 font-semibold text-blue-500 " href="/blogs/">博客</a></li><li><a class="block py-2 pr-4 pl-3 font-semibold " href="/tags/">标签</a></li><li><a class="block py-2 pr-4 pl-3 font-semibold " href="/series/">系列</a></li><li><a class="block py-2 pr-4 pl-3 font-semibold " href="/about/">关于</a></li></ul><ul class="flex-row space-x-6 border-l dark:border-slate-600 ml-6 pl-6 hidden md:flex"><li><div class="relative"><button class=" flex h-10 flex-row items-center py-2 focus:outline-none text-inherit" id="headlessui-popover-button-:Rcr6:" type="button" aria-expanded="false"><span class="dark:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg> <!-- --></span><span class="hidden dark:inline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></svg></span></button></div></li><li><a href="https://github.com/gauliang" target="_blank" rel="noreferrer" class="block py-1 "><svg class="w-8 h-8" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z"></path></svg></a></li></ul></div><div class="flex px-4 justify-between items-center md:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path></svg><div class="relative"><button class=" flex h-10 flex-row items-center py-2 focus:outline-none text-inherit" id="headlessui-popover-button-:R536:" type="button" aria-expanded="false"><span class="dark:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg> <!-- --></span><span class="hidden dark:inline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></svg></span></button></div></div></div></nav><main class="mx-auto container"><div class="mx-5 md:mx-20 flex flex-row md:space-x-8"><div class="hidden md:block md:basis-1/6 shrink-0 py-20"><div class="sticky top-28"><div class="uppercase text-black dark:text-white font-bold">Contents</div><ul class="TableOfContents text-gray-400 mt-5 text-sm"><li class="mb-3"><a href="#hash-Flux-模型" class="nav-link ">Flux 模型</a></li><li class="mb-3"><a href="#hash-Redux-模型" class="nav-link ">Redux 模型</a></li><li class="mb-3"><a href="#hash-Redux-数据流" class="nav-link ">Redux 数据流</a></li><li class="mb-3"><a href="#hash-React-redux" class="nav-link ">React-redux</a></li><li class="mb-3"><a href="#hash-Redux-Toolkit" class="nav-link ">Redux Toolkit</a></li><li class="mb-3"><a href="#hash-参考" class="nav-link ">参考</a></li></ul></div></div><div class="basis-3/3 md:basis-2/3 lg:basis-5/6 w-full md:w-1"><div class="md:mb-12 border-gray-200 py-8 md:py-20"><div class="flex space-x-2 items-center text-sm font-light text-gray-600 dark:text-gray-400"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg><div>阅读全文约需 3 分钟</div><div class="grow"></div></div><h1 class="text-2xl md:text-5xl my-4 md:my-8 leading-tight subpixel-antialiased font-semibold">深入 React Redux</h1><div class="text-sm text-gray-600 dark:text-gray-400 font-light flex items-center space-x-2"><time>2020-11-15 08:24:14</time><span>By</span><span> Gauliang</span></div></div><article class="post-content"><div class="image-widget"><img src="/posts/2020/dive-react-redux.files/dive-react-redux.jpg" alt="深入 Redux"><div class="figcaption">深入 Redux</div></div>
<h2 id="hash-Flux-模型">Flux 模型</h2>
<p>Flux 是 Facebook 用于构建客户端 Web 应用程序的<strong>应用程序体系结构</strong>，它更像是一种模式，而不是正式的框架。
Flux 模型包含三个主要部分：Dispatcher，Store 和 View(React组件)。Flux 避免使用 MVC 来支持单向数据流。
当用户与 View 进行交互时，View 通过 Dispatcher 将 Action 分发到保存应用程序数据和业务逻辑的 Store，然后再更新受影响的 View。
在外部不能直接修改 Store 的数据，必须通过 Dispather 传递 Action 给 Store 中注册的回调函数来实现数据修改，这有助于将关注点清晰的分开。</p>
<div class="image-widget"><img src="/posts/2020/dive-react-redux.files/flux-simple.png" alt="单向数据流是 Flux 模式的核心"><div class="figcaption">单向数据流是 Flux 模式的核心</div></div>
<p>Flux 应用程序的数据沿单一方向流动，上图中 Dispatcher、Store、View 是具有独立输入输出的节点，Action 是一个简单对象，包含新数据和标识 Action 类型的 type 属性。
用户与 View 的交互会在系统中产生 Action 传播。</p>
<ol>
<li>所有数据都流经 Dispatcher，提供给 Dispatcher 的 Action 是通过 <em>Action creator</em> 方法创建的对象，这通常来自用户与视图的交互。</li>
<li>Dispatcher 通过调用注册在 Store 中的回调函数完成 Action 到 Store 的分发。在已注册的回调中，Store 将响应与其所维护状态相关的具体操作。</li>
<li>Store 触发 <code>change</code> 事件，将数据层的变化通知到 Controller-views。</li>
<li>Controller-views 监听这些事件，并从  event handler 中读取来自 Stores 的数据。</li>
<li>Controller-views 调用他们自己的 <code>setState()</code> 方法，从而在组件树中更新自身及其所有后代。</li>
</ol>
<p>这与双向数据绑定有着显著不同，应用程序状态仅在 Store 中维护，从而使应用程序的不同部分保持高度分离。单项数据流，也使整个系统变得更加可预测。
双向数据绑定会导致级联更新，其中更改一个对象会导致另一个对象更改，这也可能触发更多更新。随着应用程序的增长，这些级联更新使得由用户交互而发生的变化很难预测。</p>
<h3 id="hash-1-1-Dispatcher">1.1 Dispatcher</h3>
<p>Dispatcher 是 Flux 应用程序的中央调度器，能够分发 Action 到 Store 中。它维护一个 callback 注册表，这些回调函数(callback)能够与 Store 进行交互。
每个 Store 都在 Dispatcher 中注册自己并提供回调函数，当 <strong>Action creator</strong> 提供一个新的 Action 给 Dispatcher 时，Store 可以通过注册到注册表中的 callback 接收 Action。</p>
<p>随着应用程序的增长，Dispatcher 会变得越来越重要，它还可以通过按特定顺序调用注册的 callback 来管理 Store 之间的依赖关系。
Store 也可以声明性地等待其它 Store 完成更新，然后再进行相应的更新。</p>
<h3 id="hash-1-2-Store">1.2 Store</h3>
<p>Store 存储应用程序状态和逻辑。如上所述，Store 在 Dispatcher 中注册自己，并为其提供 callback。该 callback 将 Action 作为参数接收，callback 内部基于 Action type 的 switch
语句为不同类型的 Action 执行不同的操作，这使得 Action 能够通过 Dispatcher 更新存储在 Store 中的数据。Store 更新后，它会广播一个事件，声明其状态已经更改，视图可以查询新状态并完成更新。</p>
<h3 id="hash-1-3-Controller-view">1.3 Controller-view</h3>
<p>React 提供了视图的嵌套能力，在嵌套视图层次的顶部，我们可以通过一个特殊视图订阅 Store 的广播事件，我们称这样的视图组件为控制器视图(Controller-view)，
它能够从 Store 中获取数据，并向下传递至其后代链。当从视图接收到事件时，可通过 Store 的 <code>getter</code> 方法请求所需数据，
然后，调用 <code>setState()</code> 或 <code>forceUpdate()</code> 方法促使自己和后代的 <code>render()</code> 方法运行。</p>
<h3 id="hash-1-4-Action">1.4 Action</h3>
<p>Action 是一个简单的 js 对象，用以描述 Flux 模型中的动作，其结构为 <code>{type:'type',payload:'data'}</code>。可以将其发送给 Dispatcher 公开的方法，以实现 Action 到 Store 派发。</p>
<h2 id="hash-Redux-模型">Redux 模型</h2>
<p>由于 Flux 本身并不是框架，因此开发人员已尝试提出 Flux 模式的许多实现。最终，一个明显的赢家出现了，那就是 Redux，其已成为 React 生态中开发人员集中管理应用状态的事实标准库。</p>
<p>Redux 是一个面向 JS 应用程序的可预测状态管理器，它使用基于 <strong>Action</strong> 的事件模型来管理和更新应用程序状态，从而现集中化管理应用程序状态和逻辑。
作为一个通用解决方案，Redux 可与任何 UI 层一起使用，如 React、Angular、Vue 等。虽然 Redux 是 Flux 架构的实现，但也存在一些细微差异。</p>
<h3 id="hash-2-1-Actions">2.1 Actions</h3>
<p>这与 Flux 中的定义相同，Action 是一个 JS 简单对象，包含 <code>type</code> 字段及一些可选的载荷信息。可以把 Action 理解为描述应用中事件的描述。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> addTodoAction <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/todoAdded'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'Buy milk'</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="hash-2-2-Action-Creators">2.2 Action Creators</h3>
<p><strong>Action Creator</strong> 是一个创建并返回 Action 对象的方法，通过它可以避免在每次使用 Action 时书写重复的代码。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/todoAdded'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> text
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="hash-2-3-Reducers">2.3 Reducers</h3>
<p>Reducer 是一个函数，它接收两个参数，分别为当前 <code>state</code> 和 <code>action</code> 对象，Reducer 内部决定如何更新 state，并返回一个新的 state。可以描述为 <code>(state, action) => newState</code>。
可以把 Reducer 视为事件侦听器，该事件侦听器根据接收到的 action(event) 来处理事件。Reducer 必须遵循下列规则：</p>
<ol>
<li>通过 <code>state</code> 和 <code>action</code> 参数计算并返回 <strong>全新的</strong> <code>state</code>；</li>
<li>不能修改已经存在的 <code>state</code>，内部可以通过拷贝已经存在的 <code>state</code> 进行相关操作；</li>
<li>不能具有副作用(side effects)。如果用同样的参数两次调用必须返回可预期的结果，内部不能出现如异步或 random 之类的操作；</li>
</ol>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">counterReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'counter/increment'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> state
<span class="token punctuation">}</span>
</code></pre></div>
<p>Reducer 内部可以通过 <code>if/else</code> 或 <code>switch</code> 等语句，根据不同的 <code>action.type</code> 作出不同的响应并返回新的 <code>state</code>。</p>
<h3 id="hash-2-4-Store">2.4 Store</h3>
<p>Redux 应用的当前 <code>state</code> 保存在一个称为 <strong>Store</strong> 的对象上，<strong>Store</strong> 对象通过传入 Reducer 创建，并对外提供 <code>getState</code> 方法，该方法返回当前 <code>state</code> 信息。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>counterReducer<span class="token punctuation">)</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// {value: 0}</span>

</code></pre></div>
<h3 id="hash-2-5-Dispatch">2.5 Dispatch</h3>
<p>Redux Store 对象还拥有一个名为 <code>dispatch</code> 的方法，更新 <code>state</code> 的唯一方法就是传递一个 <code>action</code> 对象给该方法。Store 内部会执行 reducer 方法，并保存一份新数据。
当我们再次调用 <code>getState()</code> 将会返回更新过的 <code>state</code>。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js">store<span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'counter/increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// {value: 1}</span>
</code></pre></div>
<p>您可以将 Dispatch 视为 <strong>触发事件</strong>，通过 Dispatch 通知 Store 应用中存在 Action 需要处理，Reducer 的行为就像事件侦听器，当他们接收到自己感兴趣的 Action 时，会响应事件并更新状态。</p>
<h3 id="hash-2-6-Selector">2.6 Selector</h3>
<p>Selector 是可以从 Store State 中提取特定信息的函数。当应用程序变得庞大时，它将变得很有用。</p>
<h2 id="hash-Redux-数据流">Redux 数据流</h2>
<ol>
<li>初始化
<ol>
<li>使用 <strong>root reducer</strong> 创建 <strong>Redux store</strong>;</li>
<li><strong>Store</strong> 调用 <code>reducer</code> 并保存其初始值；</li>
<li>当 View 第一次被渲染，会从 Redux store 中访问当前 <code>state</code> 并根据 <code>state</code> 渲染视图。View 也可以订阅 Store 的变更消息，这样在未来当 state 再次变化，视图就能够发现并处理它。</li>
</ol>
</li>
<li>更新数据
<ol>
<li>当一些事情在应用中发生，如用户点击了某个按钮，会创建 Action；</li>
<li>分发 Action 到 Redux Store，代码类似 <code>dispatch({type:"counter/increment"})</code>;</li>
<li>Store 再次执行 reducer 函数，通过之前的 <code>state</code> 和 <code>action</code> 完成计算、存储并返回新的 <code>state</code>；</li>
<li>Store 通知所有订阅了 Store 数据变更消息的 View 组件；</li>
<li>每个依赖 <code>state</code> 数据的 View 组件都会对 <code>state</code> 数据进行检查，以确定是否需要重新渲染自己；</li>
<li>需要重新渲染的组件使用新数据完成渲染。</li>
</ol>
</li>
</ol>
<div class="image-widget"><img src="/posts/2020/dive-react-redux.files/ReduxDataFlowDiagram.gif" alt=""></div>
<h2 id="hash-React-redux">React-redux</h2>
<p>Redux 本身是一个独立的库，可与任何 UI 层或框架一起使用，通常需要使用 <strong>UI 绑定库</strong> 将 Redux 与 UI 框架绑定在一起，而不是通过 UI 代码直接与 <strong>Store</strong> 进行交互。
React Redux 是 React 的官方 Redux UI 绑定库，它使得 React 组件可以从 Redux store 读取数据或分发 <code>action</code> 到 <strong>Store</strong> 以更新 <code>state</code>。</p>
<h3 id="hash-5-1-Provider">5.1 Provider</h3>
<p>React Redux 提供了一个 <code>&#x3C;Provider /></code> 组件，将 <strong>store</strong> 对象以 props 形式注入到组件中，可以使其所有子组件中均可访问到 store 对象。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">React</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ReactDOM</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Provider</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword module">import</span> <span class="token imports">store</span> <span class="token keyword module">from</span> <span class="token string">'./store'</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App'</span>

<span class="token keyword">const</span> rootElement <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Provider</span> store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Provider</span><span class="token operator">></span><span class="token punctuation">,</span>
  rootElement
<span class="token punctuation">)</span>
</code></pre></div>
<h3 id="hash-5-2-Connect">5.2 Connect</h3>
<p>React Redux 通过名为 <code>connect</code> 的函数将组件和 <strong>store</strong> 对象进行链接，随后在组件内部能以 props 的形式访问 <code>dispatch</code> 和 <code>state</code>。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> connect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actionCreators'</span>

<span class="token keyword">const</span> mapStateToProps <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token comment">/*, ownProps*/</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">counter</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset <span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Counter</span><span class="token punctuation">)</span>
</code></pre></div>
<h2 id="hash-Redux-Toolkit">Redux Toolkit</h2>
<p>Redux Toolkit 通过遵循 Redux 最佳实践，提供了良好的默认行为，捕获错误并允许您编写更简单的代码，使编写良好的 Redux 应用程序和加快开发速度变得更加容易。</p>
<p>Redux Toolkit 提供了一系列实用功能，包括：</p>
<ol>
<li><code>configureStore()</code> —— 简化创建 Store 配置选项。它可以自动组合 Reducer slice，并加载常用中间件，如 <code>redux-thunk</code>，并默认启用哪个 <strong>Redux DevTools Extension</strong>；</li>
<li><code>createReducer()</code> —— 内部自动使用 <code>immer</code> 简化了数据更新；</li>
<li><code>createAction()</code> —— 为给定动作类型字符串创建 <strong>action creator</strong> 函数。</li>
<li><code>createSlice</code> —— 接受一组配置信息，如 name、initialState。自动生成 action coretor；</li>
<li><code>createSelector</code> —— 更加便捷的从 state 中导出需要的数据</li>
</ol>
<p>Redux Toolkit 不仅简化了很多操作流程，还提供了一系列 Hook，使得在 React 组件中与 Redux Store 交互变轻而易举。</p>
<h2 id="hash-参考">参考</h2>
<ul>
<li><a target="_blank" target="_blank" class="ext-link" href="https://redux.js.org">https://redux.js.org</a></li>
<li><a target="_blank" target="_blank" class="ext-link" href="https://react-redux.js.org">https://react-redux.js.org</a></li>
<li><a target="_blank" target="_blank" class="ext-link" href="https://facebook.github.io/flux/">https://facebook.github.io/flux/</a></li>
</ul>
</article><div class="flex flex-wrap items-center md:space-x-2 my-24 pt-8 border-t border-solid border-gray-100 dark:border-gray-600"><div class="font-bold text-black text-base dark:text-white "><strong>标签：</strong></div><div class="text-blue-600 flex text-sm flex-wrap dark:text-slate-400"><a class="mr-4 hover:underline" href="/tags/react/">REACT</a><a class="mr-4 hover:underline" href="/tags/redux/">REDUX</a><a class="mr-4 hover:underline" href="/tags/flux/">FLUX</a><a class="mr-4 hover:underline" href="/tags/javascript/">JAVASCRIPT</a><a class="mr-4 hover:underline" href="/tags/node.js">NODE.JS</a><a class="mr-4 hover:underline" href="/tags/redux-toolkit/">REDUX-TOOLKIT</a></div></div><div class="next-and-prev-post"><a class="prev-post" href="/blogs/2020/dive-into-webpack/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"></path></svg><div class="text"><div class="caption">2020-11-05 08:34:50</div><div class="title">深入 Webpack</div></div></a><a class="next-post" href="/blogs/2020/throttle-and-debounce/"><div class="text"><div class="caption">2020-11-26 18:15:32</div><div class="title">Throttling and Debounce</div></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"></path></svg></a></div></div><div class="hidden lg:block md:basis-1/6 shrink-0 relative"></div></div><button class="hidden md:flex scroll-to-top rounded-full whitespace-nowrap space-x-2 flex-row text-xs items-center uppercase py-2 px-5 text-white bg-blue-600 hover:bg-gray-800 transition"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5zm-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z"></path></svg><span>Scroll to top</span></button></main><footer class="border-t dark:border-gray-700"><div class="container mx-auto flex flex-row justify-center py-16 opacity-50 hover:opacity-100 transition duration-500"><div class="text-center"><a class="flex justify-center mb-3 text-blue-500" href="/"><svg class="w-8 h-8 my-1" viewBox="0 0 512 512" fill="currentColor"><path d="M238.74,366.17c-24.56,0.42-12.59,0.42-36.76,0 C92.86,358.74,92.54,257.24,92.54,257.24s-3.78-104.91,109.44-110.42c105.79,0.4,195.22,0.23,242.54,0.08 c40.86-0.53,36.61-7.61,26.7-24.61C447.75,81.99,384.8,3.28,250.71,0C-60.02,17.45-88.35,433.93,194.97,504.76 c42.5,12.75,91.65,4.77,91.65,4.77s-0.23-52.54,0-94.13C286.82,378.65,274.71,365.55,238.74,366.17z M482.55,207.28 c-12,0.02-229.21,1.03-280.57,0.86c-48.75-0.16-48.73,49.23-48.73,49.23s0.19,47.49,48.73,47.5c-0.03,0,109.56-0.35,121.41,0 c11.91,0.35,24.03,12.59,23.94,25.04c-0.19,27.35,0.46,163.59,0.64,163.53c24.08-8.5,157.24-66.58,161.49-236.57 C510.08,231.99,506.75,207.3,482.55,207.28z"></path></svg></a><code class=" text-xs font-mono text-gray-500">$ echo &quot;simple things scale.&quot; </code></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":["posts","2020","dive-react-redux"],"contentHtml":"\u003cdiv class=\"image-widget\"\u003e\u003cimg src=\"/posts/2020/dive-react-redux.files/dive-react-redux.jpg\" alt=\"深入 Redux\"\u003e\u003cdiv class=\"figcaption\"\u003e深入 Redux\u003c/div\u003e\u003c/div\u003e\n\u003ch2 id=\"hash-Flux-模型\"\u003eFlux 模型\u003c/h2\u003e\n\u003cp\u003eFlux 是 Facebook 用于构建客户端 Web 应用程序的\u003cstrong\u003e应用程序体系结构\u003c/strong\u003e，它更像是一种模式，而不是正式的框架。\nFlux 模型包含三个主要部分：Dispatcher，Store 和 View(React组件)。Flux 避免使用 MVC 来支持单向数据流。\n当用户与 View 进行交互时，View 通过 Dispatcher 将 Action 分发到保存应用程序数据和业务逻辑的 Store，然后再更新受影响的 View。\n在外部不能直接修改 Store 的数据，必须通过 Dispather 传递 Action 给 Store 中注册的回调函数来实现数据修改，这有助于将关注点清晰的分开。\u003c/p\u003e\n\u003cdiv class=\"image-widget\"\u003e\u003cimg src=\"/posts/2020/dive-react-redux.files/flux-simple.png\" alt=\"单向数据流是 Flux 模式的核心\"\u003e\u003cdiv class=\"figcaption\"\u003e单向数据流是 Flux 模式的核心\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eFlux 应用程序的数据沿单一方向流动，上图中 Dispatcher、Store、View 是具有独立输入输出的节点，Action 是一个简单对象，包含新数据和标识 Action 类型的 type 属性。\n用户与 View 的交互会在系统中产生 Action 传播。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e所有数据都流经 Dispatcher，提供给 Dispatcher 的 Action 是通过 \u003cem\u003eAction creator\u003c/em\u003e 方法创建的对象，这通常来自用户与视图的交互。\u003c/li\u003e\n\u003cli\u003eDispatcher 通过调用注册在 Store 中的回调函数完成 Action 到 Store 的分发。在已注册的回调中，Store 将响应与其所维护状态相关的具体操作。\u003c/li\u003e\n\u003cli\u003eStore 触发 \u003ccode\u003echange\u003c/code\u003e 事件，将数据层的变化通知到 Controller-views。\u003c/li\u003e\n\u003cli\u003eController-views 监听这些事件，并从  event handler 中读取来自 Stores 的数据。\u003c/li\u003e\n\u003cli\u003eController-views 调用他们自己的 \u003ccode\u003esetState()\u003c/code\u003e 方法，从而在组件树中更新自身及其所有后代。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这与双向数据绑定有着显著不同，应用程序状态仅在 Store 中维护，从而使应用程序的不同部分保持高度分离。单项数据流，也使整个系统变得更加可预测。\n双向数据绑定会导致级联更新，其中更改一个对象会导致另一个对象更改，这也可能触发更多更新。随着应用程序的增长，这些级联更新使得由用户交互而发生的变化很难预测。\u003c/p\u003e\n\u003ch3 id=\"hash-1-1-Dispatcher\"\u003e1.1 Dispatcher\u003c/h3\u003e\n\u003cp\u003eDispatcher 是 Flux 应用程序的中央调度器，能够分发 Action 到 Store 中。它维护一个 callback 注册表，这些回调函数(callback)能够与 Store 进行交互。\n每个 Store 都在 Dispatcher 中注册自己并提供回调函数，当 \u003cstrong\u003eAction creator\u003c/strong\u003e 提供一个新的 Action 给 Dispatcher 时，Store 可以通过注册到注册表中的 callback 接收 Action。\u003c/p\u003e\n\u003cp\u003e随着应用程序的增长，Dispatcher 会变得越来越重要，它还可以通过按特定顺序调用注册的 callback 来管理 Store 之间的依赖关系。\nStore 也可以声明性地等待其它 Store 完成更新，然后再进行相应的更新。\u003c/p\u003e\n\u003ch3 id=\"hash-1-2-Store\"\u003e1.2 Store\u003c/h3\u003e\n\u003cp\u003eStore 存储应用程序状态和逻辑。如上所述，Store 在 Dispatcher 中注册自己，并为其提供 callback。该 callback 将 Action 作为参数接收，callback 内部基于 Action type 的 switch\n语句为不同类型的 Action 执行不同的操作，这使得 Action 能够通过 Dispatcher 更新存储在 Store 中的数据。Store 更新后，它会广播一个事件，声明其状态已经更改，视图可以查询新状态并完成更新。\u003c/p\u003e\n\u003ch3 id=\"hash-1-3-Controller-view\"\u003e1.3 Controller-view\u003c/h3\u003e\n\u003cp\u003eReact 提供了视图的嵌套能力，在嵌套视图层次的顶部，我们可以通过一个特殊视图订阅 Store 的广播事件，我们称这样的视图组件为控制器视图(Controller-view)，\n它能够从 Store 中获取数据，并向下传递至其后代链。当从视图接收到事件时，可通过 Store 的 \u003ccode\u003egetter\u003c/code\u003e 方法请求所需数据，\n然后，调用 \u003ccode\u003esetState()\u003c/code\u003e 或 \u003ccode\u003eforceUpdate()\u003c/code\u003e 方法促使自己和后代的 \u003ccode\u003erender()\u003c/code\u003e 方法运行。\u003c/p\u003e\n\u003ch3 id=\"hash-1-4-Action\"\u003e1.4 Action\u003c/h3\u003e\n\u003cp\u003eAction 是一个简单的 js 对象，用以描述 Flux 模型中的动作，其结构为 \u003ccode\u003e{type:'type',payload:'data'}\u003c/code\u003e。可以将其发送给 Dispatcher 公开的方法，以实现 Action 到 Store 派发。\u003c/p\u003e\n\u003ch2 id=\"hash-Redux-模型\"\u003eRedux 模型\u003c/h2\u003e\n\u003cp\u003e由于 Flux 本身并不是框架，因此开发人员已尝试提出 Flux 模式的许多实现。最终，一个明显的赢家出现了，那就是 Redux，其已成为 React 生态中开发人员集中管理应用状态的事实标准库。\u003c/p\u003e\n\u003cp\u003eRedux 是一个面向 JS 应用程序的可预测状态管理器，它使用基于 \u003cstrong\u003eAction\u003c/strong\u003e 的事件模型来管理和更新应用程序状态，从而现集中化管理应用程序状态和逻辑。\n作为一个通用解决方案，Redux 可与任何 UI 层一起使用，如 React、Angular、Vue 等。虽然 Redux 是 Flux 架构的实现，但也存在一些细微差异。\u003c/p\u003e\n\u003ch3 id=\"hash-2-1-Actions\"\u003e2.1 Actions\u003c/h3\u003e\n\u003cp\u003e这与 Flux 中的定义相同，Action 是一个 JS 简单对象，包含 \u003ccode\u003etype\u003c/code\u003e 字段及一些可选的载荷信息。可以把 Action 理解为描述应用中事件的描述。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e addTodoAction \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todos/todoAdded'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003epayload\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Buy milk'\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"hash-2-2-Action-Creators\"\u003e2.2 Action Creators\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eAction Creator\u003c/strong\u003e 是一个创建并返回 Action 对象的方法，通过它可以避免在每次使用 Action 时书写重复的代码。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eaddTodo\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token parameter\"\u003etext\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todos/todoAdded'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003epayload\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e text\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"hash-2-3-Reducers\"\u003e2.3 Reducers\u003c/h3\u003e\n\u003cp\u003eReducer 是一个函数，它接收两个参数，分别为当前 \u003ccode\u003estate\u003c/code\u003e 和 \u003ccode\u003eaction\u003c/code\u003e 对象，Reducer 内部决定如何更新 state，并返回一个新的 state。可以描述为 \u003ccode\u003e(state, action) =\u003e newState\u003c/code\u003e。\n可以把 Reducer 视为事件侦听器，该事件侦听器根据接收到的 action(event) 来处理事件。Reducer 必须遵循下列规则：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e通过 \u003ccode\u003estate\u003c/code\u003e 和 \u003ccode\u003eaction\u003c/code\u003e 参数计算并返回 \u003cstrong\u003e全新的\u003c/strong\u003e \u003ccode\u003estate\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e不能修改已经存在的 \u003ccode\u003estate\u003c/code\u003e，内部可以通过拷贝已经存在的 \u003ccode\u003estate\u003c/code\u003e 进行相关操作；\u003c/li\u003e\n\u003cli\u003e不能具有副作用(side effects)。如果用同样的参数两次调用必须返回可预期的结果，内部不能出现如异步或 random 之类的操作；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e initialState \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token literal-property property\"\u003evalue\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecounterReducer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003estate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initialState\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e action\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaction\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etype\u003c/span\u003e \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e'counter/increment'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003estate\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003evalue\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e state\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003evalue\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e state\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eReducer 内部可以通过 \u003ccode\u003eif/else\u003c/code\u003e 或 \u003ccode\u003eswitch\u003c/code\u003e 等语句，根据不同的 \u003ccode\u003eaction.type\u003c/code\u003e 作出不同的响应并返回新的 \u003ccode\u003estate\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 id=\"hash-2-4-Store\"\u003e2.4 Store\u003c/h3\u003e\n\u003cp\u003eRedux 应用的当前 \u003ccode\u003estate\u003c/code\u003e 保存在一个称为 \u003cstrong\u003eStore\u003c/strong\u003e 的对象上，\u003cstrong\u003eStore\u003c/strong\u003e 对象通过传入 Reducer 创建，并对外提供 \u003ccode\u003egetState\u003c/code\u003e 方法，该方法返回当前 \u003ccode\u003estate\u003c/code\u003e 信息。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e store \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecounterReducer\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e   \u003cspan class=\"token comment\"\u003e// {value: 0}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"hash-2-5-Dispatch\"\u003e2.5 Dispatch\u003c/h3\u003e\n\u003cp\u003eRedux Store 对象还拥有一个名为 \u003ccode\u003edispatch\u003c/code\u003e 的方法，更新 \u003ccode\u003estate\u003c/code\u003e 的唯一方法就是传递一个 \u003ccode\u003eaction\u003c/code\u003e 对象给该方法。Store 内部会执行 reducer 方法，并保存一份新数据。\n当我们再次调用 \u003ccode\u003egetState()\u003c/code\u003e 将会返回更新过的 \u003ccode\u003estate\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003estore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edispatch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'counter/increment'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e   \u003cspan class=\"token comment\"\u003e// {value: 1}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e您可以将 Dispatch 视为 \u003cstrong\u003e触发事件\u003c/strong\u003e，通过 Dispatch 通知 Store 应用中存在 Action 需要处理，Reducer 的行为就像事件侦听器，当他们接收到自己感兴趣的 Action 时，会响应事件并更新状态。\u003c/p\u003e\n\u003ch3 id=\"hash-2-6-Selector\"\u003e2.6 Selector\u003c/h3\u003e\n\u003cp\u003eSelector 是可以从 Store State 中提取特定信息的函数。当应用程序变得庞大时，它将变得很有用。\u003c/p\u003e\n\u003ch2 id=\"hash-Redux-数据流\"\u003eRedux 数据流\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e初始化\n\u003col\u003e\n\u003cli\u003e使用 \u003cstrong\u003eroot reducer\u003c/strong\u003e 创建 \u003cstrong\u003eRedux store\u003c/strong\u003e;\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eStore\u003c/strong\u003e 调用 \u003ccode\u003ereducer\u003c/code\u003e 并保存其初始值；\u003c/li\u003e\n\u003cli\u003e当 View 第一次被渲染，会从 Redux store 中访问当前 \u003ccode\u003estate\u003c/code\u003e 并根据 \u003ccode\u003estate\u003c/code\u003e 渲染视图。View 也可以订阅 Store 的变更消息，这样在未来当 state 再次变化，视图就能够发现并处理它。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e更新数据\n\u003col\u003e\n\u003cli\u003e当一些事情在应用中发生，如用户点击了某个按钮，会创建 Action；\u003c/li\u003e\n\u003cli\u003e分发 Action 到 Redux Store，代码类似 \u003ccode\u003edispatch({type:\"counter/increment\"})\u003c/code\u003e;\u003c/li\u003e\n\u003cli\u003eStore 再次执行 reducer 函数，通过之前的 \u003ccode\u003estate\u003c/code\u003e 和 \u003ccode\u003eaction\u003c/code\u003e 完成计算、存储并返回新的 \u003ccode\u003estate\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003eStore 通知所有订阅了 Store 数据变更消息的 View 组件；\u003c/li\u003e\n\u003cli\u003e每个依赖 \u003ccode\u003estate\u003c/code\u003e 数据的 View 组件都会对 \u003ccode\u003estate\u003c/code\u003e 数据进行检查，以确定是否需要重新渲染自己；\u003c/li\u003e\n\u003cli\u003e需要重新渲染的组件使用新数据完成渲染。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"image-widget\"\u003e\u003cimg src=\"/posts/2020/dive-react-redux.files/ReduxDataFlowDiagram.gif\" alt=\"\"\u003e\u003c/div\u003e\n\u003ch2 id=\"hash-React-redux\"\u003eReact-redux\u003c/h2\u003e\n\u003cp\u003eRedux 本身是一个独立的库，可与任何 UI 层或框架一起使用，通常需要使用 \u003cstrong\u003eUI 绑定库\u003c/strong\u003e 将 Redux 与 UI 框架绑定在一起，而不是通过 UI 代码直接与 \u003cstrong\u003eStore\u003c/strong\u003e 进行交互。\nReact Redux 是 React 的官方 Redux UI 绑定库，它使得 React 组件可以从 Redux store 读取数据或分发 \u003ccode\u003eaction\u003c/code\u003e 到 \u003cstrong\u003eStore\u003c/strong\u003e 以更新 \u003ccode\u003estate\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 id=\"hash-5-1-Provider\"\u003e5.1 Provider\u003c/h3\u003e\n\u003cp\u003eReact Redux 提供了一个 \u003ccode\u003e\u0026#x3C;Provider /\u003e\u003c/code\u003e 组件，将 \u003cstrong\u003estore\u003c/strong\u003e 对象以 props 形式注入到组件中，可以使其所有子组件中均可访问到 store 对象。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'react'\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eReactDOM\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'react-dom'\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProvider\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'react-redux'\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003estore\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./store'\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eApp\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./App'\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e rootElement \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token dom variable\"\u003edocument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'root'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token maybe-class-name\"\u003eReactDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erender\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eProvider\u003c/span\u003e store\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003estore\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eApp\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eProvider\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  rootElement\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"hash-5-2-Connect\"\u003e5.2 Connect\u003c/h3\u003e\n\u003cp\u003eReact Redux 通过名为 \u003ccode\u003econnect\u003c/code\u003e 的函数将组件和 \u003cstrong\u003estore\u003c/strong\u003e 对象进行链接，随后在组件内部能以 props 的形式访问 \u003ccode\u003edispatch\u003c/code\u003e 和 \u003ccode\u003estate\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e connect \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'react-redux'\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e increment\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e decrement\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e reset \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./actionCreators'\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e mapStateToProps \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estate \u003cspan class=\"token comment\"\u003e/*, ownProps*/\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003ecounter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e state\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecounter\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e mapDispatchToProps \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e increment\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e decrement\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e reset \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token function\"\u003econnect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  mapStateToProps\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  mapDispatchToProps\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eCounter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"hash-Redux-Toolkit\"\u003eRedux Toolkit\u003c/h2\u003e\n\u003cp\u003eRedux Toolkit 通过遵循 Redux 最佳实践，提供了良好的默认行为，捕获错误并允许您编写更简单的代码，使编写良好的 Redux 应用程序和加快开发速度变得更加容易。\u003c/p\u003e\n\u003cp\u003eRedux Toolkit 提供了一系列实用功能，包括：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003econfigureStore()\u003c/code\u003e —— 简化创建 Store 配置选项。它可以自动组合 Reducer slice，并加载常用中间件，如 \u003ccode\u003eredux-thunk\u003c/code\u003e，并默认启用哪个 \u003cstrong\u003eRedux DevTools Extension\u003c/strong\u003e；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreateReducer()\u003c/code\u003e —— 内部自动使用 \u003ccode\u003eimmer\u003c/code\u003e 简化了数据更新；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreateAction()\u003c/code\u003e —— 为给定动作类型字符串创建 \u003cstrong\u003eaction creator\u003c/strong\u003e 函数。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreateSlice\u003c/code\u003e —— 接受一组配置信息，如 name、initialState。自动生成 action coretor；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreateSelector\u003c/code\u003e —— 更加便捷的从 state 中导出需要的数据\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eRedux Toolkit 不仅简化了很多操作流程，还提供了一系列 Hook，使得在 React 组件中与 Redux Store 交互变轻而易举。\u003c/p\u003e\n\u003ch2 id=\"hash-参考\"\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" target=\"_blank\" class=\"ext-link\" href=\"https://redux.js.org\"\u003ehttps://redux.js.org\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" target=\"_blank\" class=\"ext-link\" href=\"https://react-redux.js.org\"\u003ehttps://react-redux.js.org\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" target=\"_blank\" class=\"ext-link\" href=\"https://facebook.github.io/flux/\"\u003ehttps://facebook.github.io/flux/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","toc":[{"depth":2,"value":"Flux 模型","id":"hash-Flux-模型"},{"depth":2,"value":"Redux 模型","id":"hash-Redux-模型"},{"depth":2,"value":"Redux 数据流","id":"hash-Redux-数据流"},{"depth":2,"value":"React-redux","id":"hash-React-redux"},{"depth":2,"value":"Redux Toolkit","id":"hash-Redux-Toolkit"},{"depth":2,"value":"参考","id":"hash-参考"}],"title":"深入 React Redux","date":"2020-11-15T00:24:14.000Z","draft":false,"description":"React Redux是React的官方Redux UI绑定库 。 如果您同时使用Redux和React，则还应该使用React Redux绑定这两个库。","type":"posts","tags":["react","redux","flux","javascript","node.js","redux-toolkit"],"series":false,"author":"Gl","cover":"dive-react-redux.jpg"},"prev":{"title":"深入 Webpack","date":1604536490000,"draft":false,"description":"大多数情况下，网站不再只是用带有一些可选 JavaScript 的纯 HTML 编写，它们通常完全由 JavaScript 构建。因此，我们必须将代码打包，最小化和翻译成所有浏览器都能理解的东西，这就是webpack的用武之地。","type":"posts","tags":["webpack","devops","node.js","esm"],"series":false,"author":"Gl","cover":"webpack.jpg","path":"/blogs/2020/dive-into-webpack","slug":"2020/dive-into-webpack"},"next":{"title":"Throttling and Debounce","date":1606385732000,"draft":false,"description":"节流是指，确保连续发生的事件（函数调用）按指定频率（时间间隔）触发执行器。防抖是指，事件发生（函数调用）后，在指定时间内，同样的操作只有最后一次会生效。","type":"posts","tags":["debounce","throttle","javascript"],"series":false,"author":"Gl","cover":"throttle-and-debounce.jpg","path":"/blogs/2020/throttle-and-debounce","slug":"2020/throttle-and-debounce"}},"__N_SSG":true},"page":"/blogs/[...id]","query":{"id":["2020","dive-react-redux"]},"buildId":"S5tPGcmy4nejKnHha2s_A","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>