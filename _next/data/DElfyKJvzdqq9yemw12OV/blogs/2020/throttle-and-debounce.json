{"pageProps":{"id":["posts","2020","throttle-and-debounce"],"post":{"id":["posts","2020","throttle-and-debounce"],"contentHtml":"<div class=\"image-widget\"><img src=\"/attachments/posts/2020/throttle-and-debounce.files/throttle-and-debounce.jpg\" alt=\"\"></div>\n<h2 id=\"hash-Throttle\">Throttle</h2>\n<p>节流是指，确保连续发生的事件（函数调用）按指定频率（时间间隔）触发执行器。\n如：无论函数以什么频率被调用，均需确保在指定的时间区间内最大执行次数不超过 1 次。</p>\n<p>根据上述需求，需要缓存一个时间戳，每次函数执行时用当前时间戳与缓存时间戳进行比对，\n如果间隔大于指定要求，则更新缓存的时间戳并执行函数。接下来，我们来完成代码实现。</p>\n<ol>\n<li>定义一个高阶函数，在初始化的时候缓存时间戳；</li>\n<li>定义并返回节流函数，该函数每次被调用时，根据当前事件戳和缓存时间戳的情况来决策如何执行。</li>\n</ol>\n<p>多数场景下，节流函数会与 DOM 事件一起使用，因此需要注意 <code>this</code> 的指向问题和 <code>arguments</code> 信息的透传。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token doc-comment comment\">/**\n * Throttle\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">executor</span> <span class=\"token punctuation\">{</span>Functioin<span class=\"token punctuation\">}</span> 执行器\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">time</span> <span class=\"token punctuation\">{</span>Number<span class=\"token punctuation\">}</span> 单位毫秒\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Throttle</span></span><span class=\"token punctuation\">(</span><span class=\"token parameter\">executor<span class=\"token punctuation\">,</span> time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> prev <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> now <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>now <span class=\"token operator\">-</span> prev <span class=\"token operator\">></span> time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 运行执行器,需要注意两个细节：</span>\n            <span class=\"token comment\">// 1. 指定 this</span>\n            <span class=\"token comment\">// 2. 透传函数调用参数</span>\n            executor<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token spread operator\">...</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            prev <span class=\"token operator\">=</span> now<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>接下来，创建一个 <code>HTML</code> 文件，内容如下：</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>h2</span><span class=\"token punctuation\">></span></span>Throttle<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n...\n</code></pre></div>\n<p>我们为页面中 <code>&#x3C;div id=\"app\"></code> 元素绑定 <code>mousemove</code> 事件，当鼠标在其上面移动，\n打印函数执行时间、事件类型以及触发事件的 HTML 元素。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Throttle</span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'throttle'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mousemove\"</span><span class=\"token punctuation\">,</span> handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>打开页面，鼠标在 <code>#app</code> 上移动，将看到类似下面的输出：</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>：50:33<span class=\"token punctuation\">]</span> throttle mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>：50:34<span class=\"token punctuation\">]</span> throttle mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>：50:35<span class=\"token punctuation\">]</span> throttle mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>：50:36<span class=\"token punctuation\">]</span> throttle mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>：50:37<span class=\"token punctuation\">]</span> throttle mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n</code></pre></div>\n<p>Executor 根据节流配置(<code>1000ms</code>)均匀执行，成功打印事件类型，同时也通过 <code>this</code> 读取到了绑定事件的元素信息。</p>\n<h2 id=\"hash-Debounce\">Debounce</h2>\n<p>防抖是指，事件发生（函数调用）后，在指定时间内，同样的操作只有最后一次会生效。</p>\n<p>根据上述需求，可以缓存一个定时器，每次函数执行时判断定时器状态，如果定时器尚未执行，则重置定时器。接下来，我们来完成代码实现。</p>\n<ol>\n<li>定义一个高阶函数，声明一个缓存定时器的变量；</li>\n<li>定义并返回节流函数，该函数每次被调用时，根据已缓存的定时器状态决策如何执行。</li>\n</ol>\n<p>多数场景下，节流函数会与 DOM 事件一起使用，因此需要注意 <code>this</code> 的指向问题和 <code>arguments</code> 信息的透传。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token doc-comment comment\">/**\n * Debounce\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">executor</span> <span class=\"token punctuation\">{</span>Functioin<span class=\"token punctuation\">}</span> 执行器\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">time</span> <span class=\"token punctuation\">{</span>Number<span class=\"token punctuation\">}</span> 单位毫秒\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Debounce</span></span><span class=\"token punctuation\">(</span><span class=\"token parameter\">executor<span class=\"token punctuation\">,</span> time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">let</span> timer <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>timer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span>timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 运行执行器,需要注意两个细节：</span>\n        <span class=\"token comment\">// 1. 指定 this</span>\n        <span class=\"token comment\">// 2. 透传函数调用参数</span>\n        timer <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>executor<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>接下来，创建一个 HTML 文件，内容如下：</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>h2</span><span class=\"token punctuation\">></span></span>Debounce<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n...\n</code></pre></div>\n<p>为页面中 <code>&#x3C;div id=\"app\"></code> 元素绑定 <code>mousemove</code> 事件，当鼠标在其上面移动， 打印函数执行时间、事件类型以及触发事件的 HTML 元素。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Debounce</span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token string\">'debounce'</span><span class=\"token punctuation\">,</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mousemove\"</span><span class=\"token punctuation\">,</span> handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>打开页面，鼠标在 <code>#app</code> 上移动，将看到类似下面的输出：</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>:49:46<span class=\"token punctuation\">]</span> debounce mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>:49:48<span class=\"token punctuation\">]</span> debounce mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>:49:52<span class=\"token punctuation\">]</span> debounce mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>:49:56<span class=\"token punctuation\">]</span> debounce mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n<span class=\"token punctuation\">[</span>Thu Nov <span class=\"token number\">26</span> <span class=\"token number\">2020</span> <span class=\"token number\">19</span>:49:59<span class=\"token punctuation\">]</span> debounce mousemove <span class=\"token operator\">&#x3C;</span>div <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>​<span class=\"token string\">\"app\"</span><span class=\"token operator\">></span>​…​<span class=\"token operator\">&#x3C;</span>/div<span class=\"token operator\">></span>​\n</code></pre></div>\n<p>Executor 根据防抖配置(300ms)，对我们的连续操作进行了延时，并合并执行，成功打印事件类型，同时也通过 this 读取到了绑定事件的元素信息。</p>\n","words":2571,"toc":[{"depth":2,"value":"Throttle","id":"hash-Throttle"},{"depth":2,"value":"Debounce","id":"hash-Debounce"}],"title":"Throttling and Debounce","date":"2020-11-26T10:15:32.000Z","draft":false,"description":"节流是指，确保连续发生的事件（函数调用）按指定频率（时间间隔）触发执行器。防抖是指，事件发生（函数调用）后，在指定时间内，同样的操作只有最后一次会生效。","type":"posts","tags":["debounce","throttle","javascript"],"series":false,"author":"GauLiang","cover":"throttle-and-debounce.jpg"},"prev":{"title":"深入 React Redux","date":1605399854000,"draft":false,"description":"React Redux是React的官方Redux UI绑定库 。 如果您同时使用Redux和React，则还应该使用React Redux绑定这两个库。","type":"posts","tags":["react","redux","flux","javascript","node.js"],"series":false,"author":"GauLiang","cover":"dive-react-redux.jpg","path":"/blogs/2020/dive-react-redux","slug":"2020/dive-react-redux"},"next":{"title":"监听 Markdown 文件并热更新 Next.js 页面","author":"高国良","type":"posts","series":false,"date":1656061643954,"tags":["next.js","fast-refresh"],"description":"Next.js 提供了 Fast-Refresh 能力，它可以为您对 React 组件所做的编辑提供即时反馈。但是，当你通过 Markdown 文件提供网站内容时，由于 Markdown 不是 React 组件，热更新将失效。","draft":false,"cover":false,"path":"/blogs/2022/watch-markdown-files-and-hot-load-the-nextjs-page","slug":"2022/watch-markdown-files-and-hot-load-the-nextjs-page"}},"__N_SSG":true}