{"pageProps":{"id":["posts","2014","aynchronous-update-ui-element-in-wpf"],"post":{"id":["posts","2014","aynchronous-update-ui-element-in-wpf"],"contentHtml":"<h2 id=\"hash-XAML\">XAML</h2>\n<p>界面很简单，只有一个按钮和一个 Lable 元素，实现点击 button 时，lable 的内容从 0 开始自动递增。</p>\n<div class=\"remark-highlight\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Grid</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Label</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lable_plus<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Button</span> <span class=\"token attr-name\">Content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button_Click<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>23<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>75<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>Grid</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h2 id=\"hash-Code\">Code</h2>\n<div class=\"remark-highlight\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">button_Click</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        lable_plus<span class=\"token punctuation\">.</span>Content <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>上面的代码执行后会发现，点击按钮并不会看到；lable中数字递增，而是稍等片刻后，直接出现99999。原因在于UI线程被阻塞用以计算循环 i++ 了。</p>\n<h2 id=\"hash-方案\">方案</h2>\n<div class=\"remark-highlight\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">te_Click</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>   \n    <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       \n<span class=\"token punctuation\">}</span>\n     \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">delegate</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">PlusNumberDelegate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>   \n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>      \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lable_plus<span class=\"token punctuation\">.</span>Dispatcher<span class=\"token punctuation\">.</span><span class=\"token function\">BeginInvoke</span><span class=\"token punctuation\">(</span> DispatcherPriority<span class=\"token punctuation\">.</span>SystemIdle<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">NextNumber</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>plus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>参考 <a target=\"_blank\" target=\"_blank\" class=\"ext-link\" href=\"http://msdn.microsoft.com/zh-cn/library/ms741870.aspx\">http://msdn.microsoft.com/zh-cn/library/ms741870.aspx</a></p>\n","words":707,"toc":[{"depth":2,"value":"XAML","id":"hash-XAML"},{"depth":2,"value":"Code","id":"hash-Code"},{"depth":2,"value":"方案","id":"hash-方案"}],"title":"WPF中异步更新UI元素","author":"高国良","type":"posts","series":false,"date":"2014-08-21T23:39:00.791Z","tags":["wpf","csharp"],"description":"实现点击 button 时，lable 的内容从 0 开始自动递增。","draft":false,"cover":false},"prev":{"title":"Android 开发环境在 Windows7 下的部署安装","author":"高国良","type":"posts","series":false,"date":1407256440791,"tags":["Android"],"description":"Android SDK 为 Android 应用的开发、测试和调试提了必要的API库和开发工具。如果你是一个 Android 开发新手，推荐你下载使用 ADT Bundle 以快速开始 Android 的开发，它提供了必要的 Android sdk 组件和一个内置 ADT 的 Eclipse 版本。","draft":false,"cover":false,"path":"/blogs/2014/install-the-android-development-environment-on-the-window7-system","slug":"2014/install-the-android-development-environment-on-the-window7-system"},"next":{"title":"SFTP 命令列表以备查询","author":"高国良","type":"posts","series":false,"date":1409008260791,"tags":["sftp"],"description":"Available commands","draft":false,"cover":false,"path":"/blogs/2014/sftp-commands","slug":"2014/sftp-commands"}},"__N_SSG":true}