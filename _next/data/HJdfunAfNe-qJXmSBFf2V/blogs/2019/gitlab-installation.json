{"pageProps":{"id":["posts","2019","gitlab-installation"],"post":{"id":["posts","2019","gitlab-installation"],"contentHtml":"<h2 id=\"hash-安装并配置必要的依赖项\">安装并配置必要的依赖项</h2>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y <span class=\"token function\">curl</span> openssh-server ca-certificates\n</code></pre></div>\n<h2 id=\"hash-添加GitLab软件包存储库\">添加GitLab软件包存储库</h2>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">bash</span>\n</code></pre></div>\n<h2 id=\"hash-配置SSL数字证书\">配置SSL数字证书</h2>\n<p>做好域名解析并申请好数字证书后，将证书文件上传至 <code>/etc/gitlab/ssl/</code> 目录下，更名为 <code> gitlab.example.com.key</code> 和 <code> gitlab.example.com.key.crt</code> 。注意域名信息，这里和后面安装命令中的<code>EXTERNAL_URL</code>一致。</p>\n<h2 id=\"hash-安装软件包\">安装软件包</h2>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token assign-left variable\">EXTERNAL_URL</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://gitlab.example.com\"</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> gitlab-ce\n\n</code></pre></div>\n<h2 id=\"hash-设置初始密码\">设置初始密码</h2>\n<p>第一次访问 <code>https://gitlab.example.com</code> ，会提示设置超级管理员密码，可视化界面，设计即可。</p>\n<h2 id=\"hash-配置邮件转发\">配置邮件转发</h2>\n<p>这里需要注意网络环境，如果自己搭建 Postfix 发送邮件,需开放 STMP 25端口，各大云厂商的25端口基本上都是封禁状态，需独立申请才能开通，且使用上还有很明确的安全要求。从业务安全及运维成本来看，使用免费的 SMTP 服务其实是一个非常不错的选择，下面以新浪邮箱为例，进行 SMTP 配置：</p>\n<div class=\"remark-highlight\"><pre class=\"language-rb\"><code class=\"language-rb\">gitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_enable'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_address'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"smtp.sina.com\"</span></span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_port'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">465</span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_user_name'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"username@sina.com\"</span></span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_password'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"password\"</span></span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_authentication'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"login\"</span></span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_enable_starttls_auto'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_tls'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'gitlab_email_from'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">'username@sina.com'</span></span>\ngitlab_rails<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'smtp_domain'</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"mail.sina.com\"</span></span>\n</code></pre></div>\n<p>测试邮件发送</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">Notify.test_email<span class=\"token punctuation\">(</span><span class=\"token string\">'example@domain.com'</span>, <span class=\"token string\">'Message Subject'</span>, <span class=\"token string\">'Message Body'</span><span class=\"token punctuation\">)</span>.deliver_now\n</code></pre></div>\n<h2 id=\"hash-配置用户注册邮件提醒\">配置用户注册邮件提醒</h2>\n<ul>\n<li>Admin area > Settings > Sign-up restrictions 选中 <code>Send confirmation email on sign-up</code></li>\n</ul>\n<h2 id=\"hash-启用docker镜像仓库\">启用docker镜像仓库</h2>\n<p>准备一个解析到仓库服务器的域名，并配置申请好SSL数字证书。假设您希望可以访问容器注册表 <code> https://registry.gitlab.example.com</code> 。</p>\n<p>将您的TLS证书和密钥放入 <code> /etc/gitlab/ssl/registry.gitlab.example.com.crt</code> 和 <code>/etc/gitlab/ssl/registry.gitlab.example.com.key</code>，并确保他们具有正确的权限：</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> <span class=\"token number\">600</span> /etc/gitlab/ssl/registry.gitlab.example.com.*\n</code></pre></div>\n<p>TLS证书到位后，编辑/etc/gitlab/gitlab.rb：</p>\n<div class=\"remark-highlight\"><pre class=\"language-rg\"><code class=\"language-rg\">registry_external_url &#x26;#39;https://registry.gitlab.example.com&#x26;#39;</code></pre></div>\n<p>保存文件并重新配置GitLab以使更改生效。</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> gitlab-ctl reconfigure\n</code></pre></div>\n","words":1702,"toc":[{"depth":2,"value":"安装并配置必要的依赖项","id":"hash-安装并配置必要的依赖项"},{"depth":2,"value":"添加GitLab软件包存储库","id":"hash-添加GitLab软件包存储库"},{"depth":2,"value":"配置SSL数字证书","id":"hash-配置SSL数字证书"},{"depth":2,"value":"安装软件包","id":"hash-安装软件包"},{"depth":2,"value":"设置初始密码","id":"hash-设置初始密码"},{"depth":2,"value":"配置邮件转发","id":"hash-配置邮件转发"},{"depth":2,"value":"配置用户注册邮件提醒","id":"hash-配置用户注册邮件提醒"},{"depth":2,"value":"启用docker镜像仓库","id":"hash-启用docker镜像仓库"}],"title":"Gitlab 安装","author":"高国良","type":"posts","series":false,"date":"2019-05-28T07:55:00.791Z","tags":[],"description":"安装并配置必要的依赖项 添加GitLab软件包存储库 配置SSL数字证书 做好域名解析并申请好数字证书后，将证书文件上传至 目录下，更名为 和 。注意域名信息，这里和后面安装命令中的 一致。 安装软件包 设置初始密码 第一次访问 ，会提示设置超级管理员密码，可视化界面，设计即可。 配置邮件转发 这里","draft":false,"cover":false},"prev":{"title":"前端框架 Vue.js 概述","author":"高国良","type":"posts","series":false,"date":1557876000791,"tags":["vue"],"description":"Vue.js 是什么 图片 Vue (读音 /vjuː/，类似于 view) 是一套用于构建用户界面的渐进式框架。与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与现代化的工具链以及各种支持类库结合","draft":false,"cover":false,"path":"/blogs/2019/vue-overview","slug":"2019/vue-overview"},"next":{"title":"Gitlab 重置 root 密码","author":"高国良","type":"posts","series":false,"date":1562832420791,"tags":[],"description":"<img src=\"https__ERR__//img2018.cnblogs.com/blog/634103/201908/634103-20190812005008821-76726312.png\" class=\"desc_img\">","draft":false,"cover":false,"path":"/blogs/2019/reset-the-gitlab-root-password","slug":"2019/reset-the-gitlab-root-password"}},"__N_SSG":true}